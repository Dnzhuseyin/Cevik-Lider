<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KullanÄ±cÄ± KontrolÃ¼ - Debug</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen p-8">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-4xl font-bold mb-8">ğŸ” KullanÄ±cÄ± VeritabanÄ± KontrolÃ¼</h1>

        <!-- Actions -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
            <button onclick="checkLocalStorage()" class="bg-blue-600 hover:bg-blue-700 px-4 py-3 rounded-lg font-semibold">
                localStorage Kontrol Et
            </button>
            <button onclick="initializeUsers()" class="bg-green-600 hover:bg-green-700 px-4 py-3 rounded-lg font-semibold">
                KullanÄ±cÄ±larÄ± BaÅŸlat
            </button>
            <button onclick="clearAll()" class="bg-red-600 hover:bg-red-700 px-4 py-3 rounded-lg font-semibold">
                Hepsini Temizle
            </button>
            <button onclick="testLogin()" class="bg-purple-600 hover:bg-purple-700 px-4 py-3 rounded-lg font-semibold">
                GiriÅŸ Testi
            </button>
        </div>

        <!-- Results -->
        <div id="results" class="space-y-6">
            <div class="bg-gray-800 p-6 rounded-lg">
                <h3 class="text-xl font-bold mb-4">ğŸ“Š SonuÃ§lar:</h3>
                <pre id="output" class="bg-black p-4 rounded overflow-x-auto text-sm"></pre>
            </div>

            <!-- Coordinators -->
            <div class="bg-gray-800 p-6 rounded-lg">
                <h3 class="text-xl font-bold mb-4 text-purple-400">ğŸ‘¨â€ğŸ’¼ KoordinatÃ¶rler:</h3>
                <div id="coordinators-list" class="space-y-2"></div>
            </div>

            <!-- Students -->
            <div class="bg-gray-800 p-6 rounded-lg">
                <h3 class="text-xl font-bold mb-4 text-green-400">ğŸ‘¨â€ğŸ“ Ã–ÄŸrenciler:</h3>
                <div id="students-list" class="space-y-2"></div>
            </div>
        </div>
    </div>

    <!-- Local Auth System -->
    <script src="js/local-auth.js"></script>

    <script>
        function log(message) {
            const output = document.getElementById('output');
            const timestamp = new Date().toLocaleTimeString();
            output.textContent += `[${timestamp}] ${message}\n`;
            console.log(message);
        }

        function clearOutput() {
            document.getElementById('output').textContent = '';
        }

        function checkLocalStorage() {
            clearOutput();
            log('=== localStorage Ä°Ã‡ERÄ°ÄÄ° ===\n');

            // Check all localStorage keys
            log('Toplam localStorage anahtarÄ±: ' + localStorage.length);

            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                const value = localStorage.getItem(key);
                log(`\nKey: ${key}`);

                if (key === 'local_coordinators' || key === 'local_students') {
                    try {
                        const parsed = JSON.parse(value);
                        log(`  DeÄŸer (${parsed.length} kayÄ±t):`);
                        parsed.forEach((item, index) => {
                            log(`    ${index + 1}. ${item.email} / ${item.password}`);
                        });
                    } catch (e) {
                        log(`  DeÄŸer: ${value}`);
                    }
                } else {
                    log(`  DeÄŸer: ${value}`);
                }
            }

            // Display coordinators
            displayCoordinators();
            displayStudents();
        }

        function displayCoordinators() {
            const container = document.getElementById('coordinators-list');
            const coordinators = window.LocalAuth.getCoordinators();

            if (coordinators.length === 0) {
                container.innerHTML = '<p class="text-red-400">âŒ HiÃ§ koordinatÃ¶r bulunamadÄ±!</p>';
                return;
            }

            container.innerHTML = coordinators.map((c, i) => `
                <div class="bg-gray-700 p-4 rounded-lg">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="font-bold">${i + 1}. ${c.firstName} ${c.lastName}</p>
                            <p class="text-sm text-gray-400">Email: ${c.email}</p>
                            <p class="text-sm text-gray-400">Åifre: ${c.password}</p>
                            <p class="text-sm ${c.isActive ? 'text-green-400' : 'text-red-400'}">
                                Durum: ${c.isActive ? 'Aktif' : 'Pasif'}
                            </p>
                        </div>
                        <button onclick="testSpecificLogin('coordinator', '${c.email}', '${c.password}')"
                            class="bg-blue-600 hover:bg-blue-700 px-3 py-2 rounded text-sm">
                            Test Et
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function displayStudents() {
            const container = document.getElementById('students-list');
            const students = window.LocalAuth.getStudents();

            if (students.length === 0) {
                container.innerHTML = '<p class="text-red-400">âŒ HiÃ§ Ã¶ÄŸrenci bulunamadÄ±!</p>';
                return;
            }

            container.innerHTML = students.map((s, i) => `
                <div class="bg-gray-700 p-4 rounded-lg">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="font-bold">${i + 1}. ${s.firstName} ${s.lastName}</p>
                            <p class="text-sm text-gray-400">Email: ${s.email}</p>
                            <p class="text-sm text-gray-400">Åifre: ${s.password}</p>
                            <p class="text-sm ${s.isActive ? 'text-green-400' : 'text-red-400'}">
                                Durum: ${s.isActive ? 'Aktif' : 'Pasif'}
                            </p>
                        </div>
                        <button onclick="testSpecificLogin('student', '${s.email}', '${s.password}')"
                            class="bg-blue-600 hover:bg-blue-700 px-3 py-2 rounded text-sm">
                            Test Et
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function initializeUsers() {
            clearOutput();
            log('=== KULLANICILAR BAÅLATILIYOR ===\n');

            // Clear existing
            localStorage.removeItem('local_coordinators');
            localStorage.removeItem('local_students');
            log('âœ… Eski veriler temizlendi\n');

            // Create default users
            const coordinators = [
                {
                    email: 'koordinator@ceviklider.com',
                    password: 'CevikLider2024!',
                    firstName: 'Sistem',
                    lastName: 'KoordinatÃ¶rÃ¼',
                    role: 'coordinator',
                    title: 'EÄŸitim KoordinatÃ¶rÃ¼',
                    department: 'EÄŸitim Koordinasyonu',
                    isActive: true
                },
                {
                    email: 'admin@ceviklider.com',
                    password: 'admin123',
                    firstName: 'Admin',
                    lastName: 'User',
                    role: 'coordinator',
                    title: 'YÃ¶netici',
                    department: 'YÃ¶netim',
                    isActive: true
                }
            ];

            const students = [
                {
                    email: 'test@student.com',
                    password: 'test123',
                    firstName: 'Test',
                    lastName: 'Ã–ÄŸrenci',
                    role: 'student',
                    department: 'Test DepartmanÄ±',
                    isActive: true
                },
                {
                    email: 'ahmet.yilmaz@meb.gov.tr',
                    password: 'ahmet123',
                    firstName: 'Ahmet',
                    lastName: 'YÄ±lmaz',
                    role: 'student',
                    department: 'Ã–ÄŸretmen',
                    isActive: true
                }
            ];

            // Save to localStorage
            localStorage.setItem('local_coordinators', JSON.stringify(coordinators));
            localStorage.setItem('local_students', JSON.stringify(students));

            log('âœ… KoordinatÃ¶rler kaydedildi: ' + coordinators.length);
            coordinators.forEach(c => {
                log(`   - ${c.email} / ${c.password}`);
            });

            log('\nâœ… Ã–ÄŸrenciler kaydedildi: ' + students.length);
            students.forEach(s => {
                log(`   - ${s.email} / ${s.password}`);
            });

            log('\nğŸ‰ KullanÄ±cÄ±lar baÅŸarÄ±yla oluÅŸturuldu!');

            // Refresh display
            displayCoordinators();
            displayStudents();
        }

        function clearAll() {
            if (confirm('TÃœM VERÄ°LERÄ° SÄ°LMEK Ä°STEDÄ°ÄÄ°NÄ°ZE EMÄ°N MÄ°SÄ°NÄ°Z?')) {
                clearOutput();
                localStorage.clear();
                log('ğŸ—‘ï¸ TÃ¼m localStorage temizlendi!');
                displayCoordinators();
                displayStudents();
            }
        }

        function testLogin() {
            clearOutput();
            log('=== GÄ°RÄ°Å TESTLERÄ° ===\n');

            // Test coordinator login
            log('1ï¸âƒ£ KoordinatÃ¶r GiriÅŸi Test Ediliyor...');
            const coordResult = window.LocalAuth.loginCoordinator('koordinator@ceviklider.com', 'CevikLider2024!');
            log(`   SonuÃ§: ${coordResult.success ? 'âœ… BAÅARILI' : 'âŒ BAÅARISIZ - ' + coordResult.error}\n`);

            // Clear login state
            localStorage.removeItem('isLoggedIn');
            localStorage.removeItem('userEmail');
            localStorage.removeItem('userRole');

            // Test student login
            log('2ï¸âƒ£ Ã–ÄŸrenci GiriÅŸi Test Ediliyor...');
            const studentResult = window.LocalAuth.loginStudent('test@student.com', 'test123');
            log(`   SonuÃ§: ${studentResult.success ? 'âœ… BAÅARILI' : 'âŒ BAÅARISIZ - ' + studentResult.error}\n`);

            // Clear login state
            localStorage.removeItem('isLoggedIn');
            localStorage.removeItem('userEmail');
            localStorage.removeItem('userRole');

            // Test wrong password
            log('3ï¸âƒ£ HatalÄ± Åifre Test Ediliyor...');
            const wrongResult = window.LocalAuth.loginStudent('test@student.com', 'wrongpassword');
            log(`   SonuÃ§: ${wrongResult.success ? 'âš ï¸ SORUN VAR!' : 'âœ… DOÄRU - ' + wrongResult.error}\n`);
        }

        function testSpecificLogin(type, email, password) {
            clearOutput();
            log(`=== ${type === 'coordinator' ? 'KOORDINATÃ–R' : 'Ã–ÄRENCÄ°'} GÄ°RÄ°Å TESTÄ° ===\n`);
            log(`Email: ${email}`);
            log(`Åifre: ${password}\n`);

            let result;
            if (type === 'coordinator') {
                result = window.LocalAuth.loginCoordinator(email, password);
            } else {
                result = window.LocalAuth.loginStudent(email, password);
            }

            if (result.success) {
                log('âœ… GÄ°RÄ°Å BAÅARILI!');
                log(`KullanÄ±cÄ±: ${result.user.firstName} ${result.user.lastName}`);
                log(`Email: ${result.user.email}`);
                log(`Rol: ${result.user.role}`);

                // Clear login for next test
                setTimeout(() => {
                    localStorage.removeItem('isLoggedIn');
                    localStorage.removeItem('userEmail');
                    localStorage.removeItem('userRole');
                    log('\n(Oturum test iÃ§in temizlendi)');
                }, 1000);
            } else {
                log('âŒ GÄ°RÄ°Å BAÅARISIZ!');
                log(`Hata: ${result.error}`);
            }
        }

        // Auto-check on load
        window.addEventListener('DOMContentLoaded', function() {
            log('ğŸš€ Sayfa yÃ¼klendi\n');
            checkLocalStorage();
        });
    </script>
</body>
</html>
